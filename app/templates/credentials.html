<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no" />
    <meta name="Title" content="Request Credentials" />
    <meta name="Keywords" content="EUDI Wallet, Credentials, Enrolment" />
    <meta name="Description" content="Request Credentials for EUDI Wallet" />
    <meta name="robots" content="noindex, nofollow" />
    <meta http-equiv="Cache-Control" content="no-cache,no-store,must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}"
        type="image/vnd.microsoft.icon" />
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.gif') }}" type="image/gif" />
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/apple-touch-icon.png') }}" />
    <link href="{{ url_for('static', filename='bootstrap-3.4.1-dist/css/bootstrap.min.css') }}" rel="stylesheet"
        type="text/css" />
    <link href="{{ url_for('static', filename='css/stylesheets/custom/custom_en_9.7.1.20.1679559965505.css') }}"
        media="all" rel="stylesheet" type="text/css" />
    <link href="{{ url_for('static', filename='fontawesome-free-5.15.4-web/css/fontawesome.min.css') }}"
        rel="stylesheet" type="text/css" />
    <script type="text/javascript" id="jqueryId"
        src="{{ url_for('static', filename='scripts/jquery/jquery-3.6.3.min.js') }}" charset="UTF-8"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='scripts/promiz/promiz-1.0.6.js') }}"
        charset="UTF-8"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='bootstrap-3.4.1-dist/js/bootstrap.min.js') }}"
        charset="UTF-8" defer="true"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='scripts/html5shiv/html5shiv-3.7.3.js') }}"
        charset="UTF-8"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='scripts/respond/respond-1.4.2.js') }}"
        charset="UTF-8"></script>
    <meta name="referrer" content="no-referrer">
    <script type="text/javascript"
        src="{{ url_for('static', filename='scripts/loc/loc_en_9.7.1.20.1679559965505.js') }}" charset="UTF-8"></script>
    <title>Credential List</title>

    <script>
        // This function will be executed when the page is fully loaded
        window.onload = function() {
            // Making a GET request to the backend server
            fetch('{{redirect_url}}credentials_list')
            .then(response => response.json()) // Parse the response as JSON
                .then(data => {
                    const credentials = data.credentialIDs;
                    const container = document.getElementById('response');

                    credentials.forEach(credential => {
                        // Create a new div for each credential
                        const credentialItem = document.createElement('div');
                        
                        // Make the div clickable
                        credentialItem.addEventListener('click', function() {
                            fetch('{{redirect_url}}set_credentialId', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({ credentialID: credential }),
                            }) // Example endpoint for demonstration
                            .then(response => console.log(response)) // Get the response as a string                
                            .catch(error => {
                                console.error('Error:', error);
                            });
                            window.location.href = "{{redirect_url}}select_pdf";
                            // Perform any action here, such as navigating to another page
                        });
                        
                        // Set the text content to the credential value
                        credentialItem.textContent = credential;

                        // Add some styling to make it clear it's clickable
                        credentialItem.style.cursor = 'pointer';
                        credentialItem.style.padding = '5px';
                        credentialItem.style.margin = '5px 0';
                        credentialItem.style.border = '1px solid #ccc';
                        credentialItem.style.borderRadius = '4px';
                        credentialItem.style.backgroundColor = '#f9f9f9';

                        // Append the div to the container
                        container.appendChild(credentialItem);
                    });
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        };
    </script>
</head>
<body id="responsive-main-nav1">

    <div class="main container-fluid"></div>
        <header role="banner" class="main-header">
            <div class="container">
                <div class="row">
                    <img src="{{url_for('static', filename='ic-logo.svg')}}">
                </div>
            </div>
        </header>
        <div role="main" class="container">
            <div class="row">
                <div class="col-lg-12">
                    <h1>Available Credentials</h1>

                    <div id="content" class="content-wrap1 content-center col-md-11 col-sm-11">
                        <div class="genericErrors" id="genericErrorsDesc"></div>
                        <div id="response">Loading...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>